<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Save Nicobar: Email Petition</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
    <style>
      body { background-color: white; color: black; padding-top: 1rem; padding-bottom: 1rem; }
      .container { max-width: 800px; }
      .btn-custom-primary { background-color: #2e4989; border-color: #2e4989; color: white; }
      .btn-custom-primary:hover, .btn-custom-primary:focus { background-color: #1e3a75; border-color: #1e3a75; color: white; }
      .btn-custom-secondary { background-color: #dfd3b9; border-color: #dfd3b9; color: black; }
      .btn-custom-secondary:hover, .btn-custom-secondary:focus { background-color: #c9bfa5; border-color: #c9bfa5; color: black; }
      .btn.disabled, .btn:disabled, fieldset:disabled .btn { pointer-events: none; opacity: 0.65; }
      .email-preview { background-color: #f8f9fa; border: 1px solid #dee2e6; padding: 1.5rem; margin-top: 1rem; border-radius: 0.375rem; white-space: pre-wrap; word-wrap: break-word; font-family: monospace; max-height: 50vh; overflow-y: auto; }
      h5, h6 { color: #2e4989; }
      #email-details p { margin-bottom: 0.5rem; word-wrap: break-word; }
    </style>
</head>
<body>
    <div class="container">
      <h5 class="mb-3 text-center">Email Preview & Actions</h5>
      <p class="text-center text-muted small">Hover over "Send Mail" to see the link. If your email app doesn't open correctly, please use the copy button.</p>
      <div class="text-center mb-4">
        <a id="send" href="#" target="_blank" class="btn btn-custom-primary btn-lg me-2 disabled" role="button" title="Generating link...">
          <i class="bi bi-send"></i> Send Mail
        </a>
        <button id="copy" class="btn btn-custom-secondary me-2" type="button">
          <i class="bi bi-clipboard"></i> Copy Email Content
        </button>
      </div>
      <h6>Email Details:</h6>
      <div id="email-details" class="mb-3">
        <p><strong>To:</strong> <span id="preview-to">(Generating...)</span></p>
        <p id="cc-line" style="display: none;"><strong>Cc:</strong> <span id="preview-cc"></span></p>
        <p id="bcc-line" style="display: none;"><strong>Bcc:</strong> <span id="preview-bcc"></span></p>
        <p><strong>Subject:</strong> <span id="preview-subject">(Generating...)</span></p>
      </div>
      <h6>Email Body Preview:</h6>
      <div id="email-preview" class="email-preview">(Generating...)</div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
      // --- Embedded Mail Generation Script START ---
      
      const TO_ADDRESS = "mefcc@gov.in,secy-moef@nic.in,cs-andaman@nic.in,lg.and@nic.in";
      const CC_ADDRESS = "";
      const BCC_ADDRESS = "solidarity@thereisnoearthb.com";
      const SUBJECT_LINES = ["Request to withdraw the proposed project for 'Holistic Development' of Great Nicobar Island in Andaman & Nicobar Islands"];
      const PARA1_OPTIONS = ["To,\n\nShri Bhupender Yadav\nMinister of State for Environment, Forests\n& Climate Change\nIndira Paryavaran Bhawan\n166, Jor Bagh Road, Block 17\nLodhi Colony, New Delhi – 110003\n\nAND\n\nMs. Leena Nandan\nSecretary, Office of the Minister of State for\nEnvironment, Forests & Climate Change\nIndira Paryavaran Bhawan\n166, Jor Bagh Road, Block 17\nLodhi Colony, New Delhi – 110003\n\nSub: Request to withdraw the proposed project for 'Holistic Development' of Great Nicobar Island in Andaman & Nicobar Islands"];
      const PARA2_OPTIONS = ["Most Respectfully,\n\nThe Great Nicobar Island, harbouring one of the richest repositories of biodiversity in the whole of South and Southeast Asia, might soon be history, as the project titled \"Holistic Development of Great Nicobar Island\" has been proposed and has quickly started progress as probably the most ambitious project undertaken in the area. This initiative aims to turn the mostly remote and untouched Great Nicobar Island into a transshipment port and tourism hotspot. The suggested plans are to make - an international Container Transhipment Terminal, a Greenfield Airport, Great Nicobar Gas and Solar Power Plant and two new Greenfield Coastal Cities.\nThis petition is in regard to the potential severe impacts of the proposed project. I, along with thousands of other concerned citizens, believe that the damage will be beyond repair if we don’t re-evaluate the severity of the situation immediately.\n\nThe Great Nicobar Island has two indigenous communities – Shompen (237 persons) and Nicobarese (1,094 persons). Though the Nicobarese have joined the mainstream, the Shompen Tribe continues to live deep within the forests, preserving their traditional aboriginal lifestyle, much like indigenous tribes globally. The Great Nicobarese, who are distinct from other Nicobarese societies of north or central Nicobar, are survived by only 420 members. The Project in question will permanently take away the ancestral villages of the Great Nicobarese. The tsunami-induced internal displacement and indiscriminate private/government doles have already diluted their traditional customs and place-based rituals and practices and have severely hampered their traditional livelihoods.\nThe Great Nicobar Island is a treasure trove of biodiversity, home to a Biosphere Reserve, Tribal Reserve, National Parks, and Wildlife Sanctuaries. It harbours some of the last remaining untouched tropical evergreen rainforests in the world, sheltering an array of endemic flora and fauna—much of which remains undocumented and unknown to the scientific community. Spanning a total area of 910 square kilometres, the island is predominantly covered by dense forests, which make up 865.84 square kilometres (95.2%) of its landscape.\nWithin this vast wilderness lies the Tribal Reserve, dedicated to preserving the traditional lifestyle of the Aboriginal Shompen Tribe, encompassing 751.40 square kilometres.The proposed project poses a serious threat to the biodiversity of Great Nicobar Island, Development here risks the loss of unique plants and animals, as well as the disruption of delicate ecological networks that have evolved over thousands of years. This island should be left intact to protect its species and preserve its role in the natural world, rather than sacrificing it for short-term gains.\nThe proposed project will threaten 30 of the 51 nesting sites of the Nicobar Megapode, a keystone species on the island. It also endangers habitats of several unique species, including leatherback turtles, the Nicobar macaque, Nicobar wild pig, Nicobar tree shrew, Great Nicobar crested serpent eagle, Nicobar paradise flycatcher, and saltwater crocodiles. This area includes two national parks that are part of a biosphere: Galathea National Park, covering 107.10 sq. km, and Campbell National Park, covering 391.75 sq. km. Hence, there is a very strong case to leave this last bastion of nature and biodiversity untouched in its pristine form for future generations. However, the proposed project cuts through the biosphere and apportions 70.6 sq.km into the project area.\nMore than 50% of the project area falls under the Tribal Reserve. Approval of the first phase of the project has already led to the diversion of 130.75 sq.km of tropical evergreen rainforest for non-forest purposes against the wishes of the indigenous tribes. The Rs.72,000 crore project will be implemented over 30 years and is expected to bring more than four lakh people to the island during that time, this has the potential to disturb the natural relationship of the indigenous communities with the environment.\nAt present, 95.2% of the Great Nicobar Island is under pristine forest cover. The proposed project envisages slicing an area of 166 sq. kms. from the total 910 sq. kms which amounts to 18.25 % of the Island’s total land mass being diverted for the project.The proposed megaproject envisages 9.64 lakhs trees will be felled and 300 hectares of land reclaimed from dredging up the ocean. These numbers that are presented by the government are valid only for the first phase of the project.\nThe second phase will involve further clear felling of forest on much of the western coast of the island. Moreover, according to calculations by a rainforest ecologist with three decades of experience, these deforestation figures are gross underestimates. The ecologist notes a mismatch between government estimates and research findings, which show that the forests, including mangroves, littoral forests, and tropical rainforests, have a density of 500 to 900 trees per hectare. Clearing 6,500 hectares would mean felling 32 to 58 lakh trees, and if all 13,000 hectares approved for clearance are cut, up to 1 crore trees could be lost.\nThis is irreparable and irretrievable tree cover loss for India and the South Asian community and we are not prepared to deal with the consequences of this decision.\nThe coral reefs of the Andaman and Nicobar Islands have been recorded as having the richest coral diversity among the Indian reef zones. However, around 4,500 coral colonies falling under the project area are currently at risk of destruction, with no clear plan for their protection. While 16,150 of the 20,668 coral colonies in the area are set to be relocated to safer locations, the remaining corals have been left without a mitigation plan. Authorities have stated that these corals will be monitored at depths of 15-30 meters to assess sedimentation levels before deciding whether to move them or take other action.\nAn earnest consideration is the role of rainforests being the carbon sinks of the world, and essential to the control of CO2 emissions. Given the seriousness with which the world is pursuing clean energy transitions, if India proceeds with deforestation on a massive scale, the country would be deemed as one of the hypocrites, doing the opposite of what it promises to do on global platforms. A negative image like that must be avoided under all circumstances. Research has found that deforestation can heat a local area by as much as 4.5°C and can even increase temperatures in undisturbed forests as far away as 6km. This research used satellite data from Indonesia, Malaysia, and Papua New Guinea (which fall in similar temperature zones to other ASEAN countries). A rise in ocean surface temperatures in Nicobar is therefore imperative as it would affect the El Nino currents which originate in the Indian Ocean area. As is well known, El Nino impacts rainfall on the Indian peninsula, putting an existential threat on the mainland with skewed rainfall patterns and an increased intensity and frequency of extreme as well as erratic weather events.\nIn July 2022, the port and several sections of the project were designated as CRZ1A, the most ecologically sensitive zone. CRZ 1A areas are protected from major development activities like port construction due to the presence of mangroves, coral reefs, and their role as nesting grounds for birds and turtles, along with other fragile ecosystems. However, without any clear justification, a government body (NCSCM) downgraded the area's protection to CRZ1B, allowing port construction to move forward.This reclassification, which came to light during legal proceedings challenging the project's environmental clearance, has raised serious concerns. The rationale behind the NCSCM's conclusions remains unclear, and despite inquiries, these conclusions have not been made public. Such changes pose significant risks to critical ecosystems and endemic species of Nicobar.\nOn June 18th, 2024, we addressed an open letter to the Social Welfare Department of the Andaman & Nicobar Administration, highlighting the discrepancies in the Social Impact Assessment (SIA) report for the Greenfield Airport project. The report, in its current form, fails to adequately consult the communities directly impacted by the project, including the Shompen, Nicobarese, and other indigenous groups living in the Great Nicobar Islands. It is crucial to safeguard the welfare, integrity, and cultural heritage of these communities as development initiatives progress. Meaningful engagement and transparent consultation with stakeholders are crucial at every stage of the decision-making process to ensure their rights are not overlooked.\nThere are also concerns of the project due to tectonic volatility and disaster vulnerability of the island. The islands are categorised under seismic zone V, the most prone to earthquakes. The proposed container terminal is at a site that experienced 444 earthquakes in the last 10 years. Experts have already warned that “In the event of a major earthquake like the one we witnessed in the Tsunami of 26 December 2004, the entire investment on infrastructure would be at risk, and the resultant oil and chemical spill would create a major environmental disaster”.\nThe claimed ‘Holistic’ Development by Govt. of India, the project proposition fails in its ambitious attempt as it is neither holistic nor all encompassing; as it violates the fundamental Environmental Laws, Rules and Regulations of the country. Preserving the Great Nicobar Biosphere, Protection of National Parks of Great Nicobar, protecting endemic and endangered Wildlife of Great Nicobar, and encroaching on Reserved Forest of indigenous tribes and against the Tribal Policy of Shompen Tribe of Great Nicobar all are part of important regulations set in place to protect the nature encompassed in the Great Nicobar Island.\nHence the ‘Holistic Development of Great Nicobar Island in Andaman & Nicobar Islands' by NITI Aayog is against nature, indigenous tribes, endangered and endemic flora and fauna and pursues a solely economic agenda, and therefore needs to be scrapped forthwith and the Great Nicobar Island left in its pristine condition without any further anthropogenic interventions."];
      const PARA3_OPTIONS = ["Hence, as a citizen, I urge you to:\nConduct an accurate assessment of tree density on the island to derive the actual number of trees to be felled in Great Nicobar due to the project.\nConduct widespread and inclusive consultations that include the relevant stakeholders affected - local and tribal communities, as well as civil society organisations - as part of the decision making process to decide their future.\nFair and scientific re-evaluation of the project’s natural disaster risks and environmental costs must be done.\nPreserve lakhs of pristine trees from being felled in Nicobar.\nSafeguard the rights and livelihoods of Shompen and Nicobarese tribes.\nProtect natural nesting sites for leatherback sea turtles, Nicobar Megapode and endangered marine species.\nWithdraw the environmental clearance given to the project.\nScrap the project in its current form due to multiple ecological and human rights concerns and identify an alternative project site with the least environmental impact and without violation of community rights.\n\nEagerly anticipating an immediate, careful, and most urgent consideration of the above matter from your end.\n\nSources and Important Reads:\n\nhttps://thewire.in/environment/ictt-infrastructure-project-great-nicobar-island\nhttps://theprint.in/environment/govt-vision-for-great-nicobar-includes-airport-township-some-experts-think-its-nonsense/814390/\nhttps://www.drishtiias.com/daily-updates/daily-news-analysis/development-project-in-the-great-nicobar-island-iinaccurate-eia\nhttps://ijpiel.com/index.php/2021/08/05/niti-aayogs-project-for-great-nicobar-island/\nhttps://news.mongabay.com/2017/11/indigenous-forests-could-be-a-key-to-averting-climate-catastrophe/\nhttps://frontline.thehindu.com/environment/great-nicobar-development-projects-disregard-risk-in-earthquake-prone-area/article66349616.ece\nhttps://thewire.in/political-economy/who-is-the-great-nicobar-holistic-development-project-really-for\nhttps://indianexpress.com/article/india/nicobar-port-plan-flagged-in-no-go-zone-earlier-now-in-permitted-area-9479875/\nhttps://india.mongabay.com/2024/08/national-coastal-body-says-great-nicobar-project-no-longer-in-prohibited-zone-making-way-for-a-port/\nhttps://scroll.in/article/1074221/1-crore-trees-not-8-5-lakh-could-be-cut-for-great-nicobar-project-one-ecologist-estimates"];
      const SIGNING_OFF_OPTIONS = ["Yours Sincerely,","In Solidarity,","With hope for justice,","Regards,"];

      // --- Use actual newline characters internally for JS logic ---
      const LINE_BREAK = "\n";
      const DOUBLE_LINE_BREAK = "\n\n";
    
      
      let mailtoLink = "";
      let copyText = ""; // Body only for preview/copy
      let selectedSubject = "";

      function getRandomElement(arr) {
        // Ensure arr is an array and not empty before accessing length
        if (!Array.isArray(arr) || arr.length === 0) return "";
        return arr[Math.floor(Math.random() * arr.length)];
      }

      function decodeHtmlEntities(text) {
				if (typeof text !== 'string' || text === "") return text;
				const textarea = document.createElement('textarea');
				textarea.innerHTML = text; // Browser parses HTML entities
				return textarea.value;
			}

      function prepareMail() {
        const sendLink = document.getElementById("send");

        try {
          let rawSelectedSubject = getRandomElement(SUBJECT_LINES);
					let rawSelectedPara1 = getRandomElement(PARA1_OPTIONS);
					let rawSelectedPara2 = getRandomElement(PARA2_OPTIONS);
					let rawSelectedPara3 = getRandomElement(PARA3_OPTIONS);
					let rawSelectedSignoff = getRandomElement(SIGNING_OFF_OPTIONS);

					// Decode them for use in mailto link and preview
					selectedSubject = decodeHtmlEntities(rawSelectedSubject);
					const decodedPara1 = decodeHtmlEntities(rawSelectedPara1);
					const decodedPara2 = decodeHtmlEntities(rawSelectedPara2);
					const decodedPara3 = decodeHtmlEntities(rawSelectedPara3);
					const decodedSignoff = decodeHtmlEntities(rawSelectedSignoff);;

          // --- Construct body using actual newlines ---
          const bodyForMailto = [
            decodedPara1,
						decodedPara2,
						decodedPara3,
						decodedSignoff,
          ].filter(p => typeof p === 'string' && p.length > 0) // Filter out potential empty strings/undefined
           .join(DOUBLE_LINE_BREAK); // Join paragraphs with internal newlines

          // --- Construct mailto link (URLSearchParams will encode \n correctly) ---
          const params = new URLSearchParams();
          // Only add params if they have a value
          if (CC_ADDRESS) params.append("cc", CC_ADDRESS);
          if (BCC_ADDRESS) params.append("bcc", BCC_ADDRESS);
          if (selectedSubject) params.append("subject", selectedSubject);
          if (bodyForMailto) params.append("body", bodyForMailto); // Let URLSearchParams handle encoding 


          // Platform Specific Adjustments (Example for iOS if needed later)
          let finalQueryString = params.toString();
          finalQueryString = finalQueryString.replace(/\+/g, '%20');

          // Platform Detection
					const userAgent = navigator.userAgent || navigator.vendor || window.opera;
					const platformNavigator = navigator.platform || ""; // For OS-level platform string

					let detectedSystem = "Unknown";
					let mailtoEncodingProfile = "standard"; // Profile to decide encoding: 'ios_specific' or 'standard'

					// iOS Detection Logic
					// 1. Check navigator.platform for direct iOS device strings (most reliable if available)
					if (/iPad|iPhone|iPod/.test(platformNavigator)) {
						detectedSystem = "iOS";
						mailtoEncodingProfile = "ios_specific";
					}
					// 2. Check userAgent for standard iOS device strings
					else if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) { // !window.MSStream helps avoid some Windows Phone false positives
						detectedSystem = "iOS";
						mailtoEncodingProfile = "ios_specific";
					}
					// 3. Check for "Macintosh" + "Mobile" in userAgent (common for iPads in desktop mode/emulators)
					else if (/Macintosh/.test(userAgent) && /Mobile/.test(userAgent)) {
						detectedSystem = "iOS";
						mailtoEncodingProfile = "ios_specific";
					}
					// 4. Check for "Macintosh" userAgent with multi-touch capability (another iPad desktop mode/emulator indicator)
					else if (/Macintosh/.test(userAgent) && navigator.maxTouchPoints && navigator.maxTouchPoints > 1) {
						detectedSystem = "iOS";
						mailtoEncodingProfile = "ios_specific";
					}
					// macOS Detection (ensure it's not an iPad already identified above)
					else if ((/Macintosh/.test(userAgent) || /MacIntel/.test(platformNavigator) || /MacPPC/.test(platformNavigator) || /Mac68K/.test(platformNavigator))) {
						detectedSystem = "macOS";
						mailtoEncodingProfile = "standard";
					}
					// Android Detection
					else if (/android/i.test(userAgent)) {
						detectedSystem = "Android";
						mailtoEncodingProfile = "standard"; // Android is generally robust
					}
					// Windows Detection
					else if (/Win/.test(platformNavigator)) {
						detectedSystem = "Windows";
						mailtoEncodingProfile = "standard";
					}
					// Linux Desktop Detection
					else if (/Linux/.test(platformNavigator) && !/android/i.test(userAgent)) { // Exclude Android's Linux
						detectedSystem = "Linux";
						mailtoEncodingProfile = "standard";
					}
					// If still "Unknown", it might be a less common OS. 'standard' is a safe default.
					console.log("Detected System:", detectedSystem);
					console.log("Using mailto encoding profile:", mailtoEncodingProfile);

					// Apply encoding adjustments based on the profile
					if (mailtoEncodingProfile === "ios_specific") {
						console.log("Applying iOS specific mailto link generation strategy.");
						finalQueryString = finalQueryString.replace(/%0A/g, '%0D%0A');
						console.log("iOS: Converted newlines from %0A to %0D%0A for better compatibility.");
					}
					
					else if (mailtoEncodingProfile === "standard") {
						console.log("Applying standard mailto link generation strategy for ", detectedSystem);
					}
					// finalQueryString is now potentially adjusted based on the platform.

					if(mailtoLink.length>1998)
						console.warn("mailto too long for Chrome: " + mailtoLink.length +" chars");
					else
						console.log("mailto length OK: "+ mailtoLink.length +" chars");

          if (TO_ADDRESS) {
             // Encode TO addresses individually, then join
             const encodedTo = TO_ADDRESS.split(",")
              .map(e => e.trim()) // Trim whitespace first
              .filter(e => e)     // Remove empty entries
              .map(e => encodeURIComponent(e)) // Then encode
              .join(",");

             if (encodedTo) { // Ensure there's at least one valid TO address after filtering/encoding
                mailtoLink = `mailto:${encodedTo}?${finalQueryString}`;
             } else {
                mailtoLink = ""; // No valid TO address
                console.error("No valid TO addresses provided after encoding.");
             }

          } else {
            mailtoLink = "";
            console.error("TO address constant is missing or empty.");
          }

          // --- Construct body text for preview/copy (plain text) ---
          copyText = [
						decodedPara1,
						decodedPara2,
						decodedPara3,
						decodedSignoff,
          ].filter(p => typeof p === 'string' && p.length > 0)
           .join('\n\n');

          // --- Update preview elements safely ---
          const toElem = document.getElementById("preview-to");
          const ccElem = document.getElementById("preview-cc");
          const ccLine = document.getElementById("cc-line");
          const bccElem = document.getElementById("preview-bcc");
          const bccLine = document.getElementById("bcc-line");
          const subjectElem = document.getElementById("preview-subject");
          const previewElem = document.getElementById("email-preview");

          if (toElem) toElem.textContent = TO_ADDRESS || '(Not specified)';
          if (ccElem && ccLine) {
              if (CC_ADDRESS) {
                  ccElem.textContent = CC_ADDRESS;
                  ccLine.style.display = 'block';
              } else {
                  ccLine.style.display = 'none';
              }
          }
          if (bccElem && bccLine) {
              if (BCC_ADDRESS) {
                  bccElem.textContent = BCC_ADDRESS;
                  bccLine.style.display = 'block';
              } else {
                  bccLine.style.display = 'none';
              }
          }
          // Display generated and decoded subject or placeholder
          if (subjectElem) subjectElem.textContent = selectedSubject || '(No subject generated)';
          // Display generated body or placeholder
          if (previewElem) previewElem.textContent = copyText || '(No body content generated)';

          // --- Update the href of the anchor tag ---
          if (sendLink) {
            if (mailtoLink) {
              sendLink.href = mailtoLink;
              sendLink.classList.remove("disabled");
              sendLink.title = "Click to open in your default email client";
            } else {
              sendLink.href = "#"; // Prevent navigation
              sendLink.classList.add("disabled"); // Visually disable
              sendLink.title = "Cannot generate email link (check TO address and console errors)";
            }
          }
        } catch (err) {
          console.error("Error in prepareMail:", err);
          alert("An error occurred while preparing the email preview. Check console for details.");
          if (sendLink) {
            sendLink.href = "#";
            sendLink.classList.add("disabled");
            sendLink.title = "Error generating email link";
          }
        }
      }

      // --- Event Listeners within generated file ---
      document.addEventListener("DOMContentLoaded", () => {
        const copyButton = document.getElementById("copy");

        if (copyButton) {
          copyButton.addEventListener("click", () => {
            // Ensure content exists before trying to copy
            if (!copyText && !selectedSubject) {
              alert("Email content not generated yet. Please reload or check generator inputs.");
              return;
            }
            // Construct the full text including headers for copying
            const fullEmailText = `To: ${TO_ADDRESS || ''}\n${
              CC_ADDRESS ? `Cc: ${CC_ADDRESS}\n` : ""
            }${
              BCC_ADDRESS ? `Bcc: ${BCC_ADDRESS}\n` : ""
            }Subject: ${selectedSubject || ''}\n\n${copyText || ''}`;

            navigator.clipboard.writeText(fullEmailText)
              .then(() => {
                alert("Email content copied to clipboard!");
              })
              .catch(err => {
                console.warn("Clipboard API failed, trying fallback:", err);
                // Fallback using temporary textarea
                const textarea = document.createElement("textarea");
                textarea.value = fullEmailText;
                textarea.style.position = "fixed"; // Prevent scrolling issues
                textarea.style.opacity = "0"; // Hide it visually
                textarea.style.left = "-9999px"; // Move off-screen
                document.body.appendChild(textarea);
                textarea.select();
                try {
                  document.execCommand("copy");
                  alert("Email content copied (fallback)!");
                } catch (errFallback) {
                  console.error("Fallback copy failed:", errFallback);
                  alert("Failed to copy automatically. Please copy manually from the preview.");
                }
                document.body.removeChild(textarea);
              });
          });
        }

        // Initial preparation on load
        prepareMail();
      });
    
      // --- Embedded Mail Generation Script END ---
    </script>
</body>
</html>